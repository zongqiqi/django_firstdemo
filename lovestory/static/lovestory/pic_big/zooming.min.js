/**
 * zooming - Image zooming with pure JavaScript.
 * @version v0.2.0
 * @link https://github.com/kingdido999/zooming
 * @license MIT
 */

+function(){"use strict";function t(){this._scaleBase=1,this._target=null,this._body=document.body,this._lastScrollPosition=null,this._scrollThreshold=40,this._handleClick=this._handleClick.bind(this),this._handleKeyDown=this._handleKeyDown.bind(this),this._handleScroll=this._handleScroll.bind(this)}function i(t){this._scaleBase=1,this._image=t,this._src=t.getAttribute("src"),this._dataOriginal=t.getAttribute("data-original"),this._overlay=null,this._body=document.body,this._zoomImage=this._zoomImage.bind(this),this._handleTransitionEnd=this._handleTransitionEnd.bind(this),this._styles={image:{width:"",height:"",transform:"",zoomIn:{position:"relative","z-index":666,"-webkit-transition":"all 300ms","-o-transition":"all 300ms",transition:"all 300ms"},zoomOut:{position:"","z-index":"","-webkit-transition":"","-o-transition":"",transition:""}},overlay:{"z-index":233,background:"#fff",position:"fixed",top:0,left:0,right:0,bottom:0,filter:"alpha(opacity=0)",opacity:0,"-webkit-transition":"opacity 300ms","-o-transition":"opacity 300ms",transition:"opacity 300ms"}}}function e(t,i){for(var e in i)t.style[e]=i[e]}function s(t,i){t.style.cursor=i,t.style.cursor="-webkit-"+i,t.style.cursor="-moz-"+i}t.prototype={init:function(){this._body.addEventListener("click",this._handleClick);for(var t=document.querySelectorAll('img[data-action="zoom"]'),i=0;i<t.length;i++)s(t[i],"zoom-in")},_handleClick:function(t){var i=t.target;if(i&&("IMG"!==i.tagName&&this._close(),i.hasAttribute("data-action")))switch(i.getAttribute("data-action")){case"zoom":this._zoom(i);break;case"close":this._close()}},_handleKeyDown:function(t){27===t.keyCode&&this._close()},_handleScroll:function(){var t=window.pageYOffset||(document.documentElement||this._body.parentNode||this._body).scrollTop;null===this._lastScrollPosition&&(this._lastScrollPosition=t);var i=this._lastScrollPosition-t;Math.abs(i)>=this._scrollThreshold&&(this._lastScrollPosition=null,this._close())},_zoom:function(t){this._target||(this._target=new i(t),this._target.zoomIn(),document.addEventListener("keydown",this._handleKeyDown),document.addEventListener("scroll",this._handleScroll))},_close:function(){this._target&&(this._target.zoomOut(),this._target=null,document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("scroll",this._handleScroll))}},i.prototype={zoomIn:function(){var t=new Image;t.onload=function(){if(this._dataOriginal){this._styles.image.width=this._image.style.width,this._styles.image.height=this._image.style.height;var t=this._image.getBoundingClientRect();e(this._image,{width:t.width+"px",height:t.height+"px"}),this._image.setAttribute("src",this._dataOriginal)}this._calculateZoom(),this._zoomImage()}.bind(this),t.src=this._src},_calculateZoom:function(){var t=this._image.getBoundingClientRect(),i={x:window.innerWidth/2,y:window.innerHeight/2},e=t.width/2,s=t.height/2,o={x:t.left+e,y:t.top+s},n={x:i.x-o.x,y:i.y-o.y},a={x:i.x-e,y:i.y-s},h=a.x/e,l=a.y/s,r=this._scaleBase+Math.min(h,l);this._styles.image.transform="translate("+n.x+"px,"+n.y+"px) scale("+r+","+r+")"},_zoomImage:function(){this._image.offsetWidth,e(this._image,this._styles.image.zoomIn),this._image.addEventListener("transitionend",this._handleTransitionEnd),this._overlay=document.createElement("div"),e(this._overlay,this._styles.overlay),this._body.appendChild(this._overlay),window.setTimeout(function(){e(this._overlay,{filter:"alpha(opacity=100)",opacity:1})}.bind(this),30),this._transform()},zoomOut:function(){this._image.addEventListener("transitionend",this._handleTransitionEnd),e(this._overlay,{filter:"alpha(opacity=0)",opacity:0}),this._styles.image.transform="",this._transform()},_transform:function(){e(this._image,{"-webkit-transform":this._styles.image.transform,"-ms-transform":this._styles.image.transform,transform:this._styles.image.transform})},_handleTransitionEnd:function(t){switch(this._image.getAttribute("data-action")){case"close":this._dataOriginal&&(e(this._image,{width:this._styles.width,height:this._styles.height}),this._image.setAttribute("src",this._src)),this._body.removeChild(this._overlay),e(this._image,this._styles.image.zoomOut),s(this._image,"zoom-in"),this._image.setAttribute("data-action","zoom");break;case"zoom":s(this._image,"zoom-out"),this._image.setAttribute("data-action","close")}this._image.removeEventListener("transitionend",this._handleTransitionEnd)}},document.addEventListener("DOMContentLoaded",function(){(new t).init()})}();